<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SEMS: How to try out SEMS without setting up a proxy</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">SEMS
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">How to try out SEMS without setting up a proxy </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="Introduction"></a>
Introduction</h2>
<p>This text describes how one can try out services in SEMS without setting up a proxy. This is the simplest way to try services in SEMS, or start with developing a service. </p>
<p>The way this works is that SEMS registers to a SIP server (registrar) with one account (bob), just like any other SIP phone, and we call SEMS from another account (alice). If the SIP server provides DID calling from the PSTN, we can use any landline or mobile phone for testing or using the service. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>What is not possible with this method is to use applications which need additional information for a call from the subscriber data. For example, in order to send a voicemail as email the SEMS server needs the email address to send the mail to.</dd></dl>
<h2><a class="anchor" id="Requirements"></a>
Requirements</h2>
<p>For compiling SEMS, as a minimum a C++ compiler and make is needed. In debian, do </p>
<div class="fragment"><pre class="fragment"> apt-<span class="keyword">get</span> install g++ make 
</pre></div><h3><a class="anchor" id="publicsip"></a>
With a public SIP server</h3>
<p>Two accounts at a public SIP server are needed. We recommend to use iptel.org's SIP service for testing, an account can be registered for free at <a href="http://iptel.org/service/">http://iptel.org/service/</a>.</p>
<p>Any SIP phone, hardphone or softphone, can be used for testing. Cross-platform, <a href="http://www.sip-communicator.org">sip-communicator</a> is recommended, for Linux <a href="http://twinklephone.com">twinkle</a>, for Windows sip-communicator, xten eyebeam or NCH express.</p>
<h3><a class="anchor" id="pstnsip"></a>
With a PSTN DID provider</h3>
<p>Alternatively a PSTN DID provider can be used. In that case, we can test and use the service with any phone. A list of DID providers is for example available at <a href="http://www.voip-info.org/wiki/view/DID+Service+Providers">voip-info</a> . <a href="http://sipgate.de">Sipgate</a> for example, provides free DID numbers in Germany.</p>
<h2><a class="anchor" id="Installing"></a>
Installing SEMS from source</h2>
<p>First, the SEMS source is downloaded from iptel.org and extracted: </p>
<div class="fragment"><pre class="fragment">     $ wget ftp.iptel.org/pub/sems/sems-latest.tar.gz
     $ tar xzvf sems-latest.tar.gz
</pre></div><p> SEMS is compiled: </p>
<div class="fragment"><pre class="fragment">    $ cd sems-x.y.z/
    $ make
</pre></div> <dl class="note"><dt><b>Note:</b></dt><dd>Compilation may fail for some modules due to missing dependencies. For most modules, that can be ignored for the moment.</dd></dl>
<p>Then SEMS is installed: </p>
<div class="fragment"><pre class="fragment">    $ make install
</pre></div><p>This will install</p>
<ul>
<li>configuration in /usr/local/etc/sems/</li>
<li>the sems binary in /usr/local/sbin/sems</li>
<li>modules in /usr/local/lib/sems/plug-in/</li>
<li>audio files in /usr/local/lib/sems/audio/</li>
</ul>
<h2><a class="anchor" id="Configuring_application"></a>
Configuring the application for SEMS</h2>
<p>There are many many modules shipped with SEMS, applications like announcement, voicemail, conference, etc, codec modules, and some things like SIP registrar client.</p>
<p>Now we configure SEMS to load the conference application and execute the conference application for incoming calls. We also set it to have itself register to our SIP server.</p>
<p>In <b>/usr/local/etc/sems/sems.conf</b>, we set </p>
<div class="fragment"><pre class="fragment">   load_plugins=wav;uac_auth;registrar_client;reg_agent;conference   
</pre></div> <p>to load the modules we need; wav is for reading WAV files and for the G711 codec, uac_auth is the module which implements authentication, registrar_client facilitates registration at a SIP server, and reg_agent is the application that uses registrar_client to have SEMS register at a SIP server.</p>
<p>We also set  </p>
<div class="fragment"><pre class="fragment">   application=conference
</pre></div> <p>so that SEMS executes the conference application for an incoming call.</p>
<p>We want SEMS to register at a SIP server, so we need to tell it about the user name and the password, this is set in <b>/usr/local/etc/sems/reg_agent.conf</b> (of course this user name bob and the password need to be set to the ones used for testing): </p>
<div class="fragment"><pre class="fragment">     domain=iptel.org
     user=bob
     display_name=bob
     auth_user=bob
     pwd=verysecret
</pre></div><h2><a class="anchor" id="Trying"></a>
Testing the setup</h2>
<p>Now we can test the configuration by running SEMS from the command line like this: </p>
<div class="fragment"><pre class="fragment">    /usr/local/sbin/sems -f /usr/local/etc/sems/sems.conf -D 3 -E
</pre></div> <p><b>-D 3</b> sets the debug level higher so that we see what is going on, and <b>-E</b> makes SEMS start in the foreground and go to daemon mode. It also makes the log appear on the terminal and not in the system log file.</p>
<p>If everything is alright, SEMS starts up with a lot of messages, and hopefully no ERROR. There should also be some messages appearing which show that SEMS registered successfully to the SIP server. </p>
<p>Now we can call bob from the other phone or our PSTN telephone. In the SEMS log, we see the call appearing, and on the phone we hear a message saying that we are the first participant in the conference.</p>
<p>If it doesnt work.... we examine the log for the ERROR that occured. Possibly, depending on the network setup, we need to change the interface that SEMS is running on; this can be changed by setting the <b>media_ip</b> and <b>sip_ip</b> options in sems.conf. Also, it might be that there is already someone using that port (default config: 5070), in that case <b>sip_port</b> needs to be set. </p>
<h2><a class="anchor" id="Running"></a>
Running as daemon</h2>
<p>If SEMS is started without the <b>-E</b> option, it will continue running as daemon in the background. The log can be seen in syslog (e.g. with <b> tail -f /var/log/daemon.log</b>).</p>
<h2><a class="anchor" id="Other_application"></a>
Running other applications</h2>
<p>If we want to run other applications, the <b>load_plugins=</b> and <b>application=</b> parameters need to be adapted. See <a class="el" href="AppDoc.html">Application Modules</a> for a description of the shipped applications.</p>
<h2><a class="anchor" id="DSM_application"></a>
Creating and running a simple DSM applications</h2>
<p>The DSM is a service development platform, that makes it simple to create powerful services. The service logis is defined as a state machine, and the DSM application interprets this state machine for the calls, evaluating when to change state, and which actions to execute. </p>
<p>To use a DSM application, we set in <b>/usr/local/etc/sems/sems.conf </b> </p>
<div class="fragment"><pre class="fragment">   load_plugins=wav;uac_auth;registrar_client;reg_agent;session_timer;dsm
   application=mydsmapp
</pre></div><p>and in <b>/usr/local/etc/sems/dsm.conf </b>: </p>
<div class="fragment"><pre class="fragment">    diag_path=/usr/local/lib/sems/dsm/
    load_diags=mydsmapp
    register_apps=mydsmapp
</pre></div><p>Then we paste this little script in /usr/local/lib/sems/dsm/mydsmapp.dsm : </p>
<div class="fragment"><pre class="fragment">  initial state BEGIN
   enter {
     playFile(/usr/local/lib/sems/audio/webconference/first_participant.wav);
   };
  transition <span class="stringliteral">&quot;file ends&quot;</span> BEGIN - noAudioTest -&gt; TYPING;
  
  state TYPING;
  transition <span class="stringliteral">&quot;typed a key&quot;</span> TYPING - keyTest(#key &lt; 10) / {
    <span class="keyword">set</span>($myfile=/usr/local/lib/sems/audio/webconference/);
    append($myfile, #key);
    append($myfile, .wav);
    playFile($myfile);
  } -&gt; TYPING;

  transition <span class="stringliteral">&quot;BYE received&quot;</span> (BEGIN, TYPING) - hangup / stop(<span class="keyword">false</span>) -&gt; END;
  state END; 
</pre></div><p>This little script welcomes the caller, and then plays the key that the caller entered. More documentation about DSM and examples are in apps/dsm/doc, and also <a class="el" href="ModuleDoc_dsm.html">DSM: State machine notation for VoIP applications</a> . </p>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
