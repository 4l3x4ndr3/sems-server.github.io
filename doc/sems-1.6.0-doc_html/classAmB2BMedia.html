<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SEMS: AmB2BMedia Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">SEMS
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">AmB2BMedia Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="AmB2BMedia" --><!-- doxytag: inherits="AmMediaSession" -->
<p>Class for control over media relaying and transcoding in a B2B session.  
 <a href="classAmB2BMedia.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="AmB2BMedia_8h_source.html">AmB2BMedia.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for AmB2BMedia:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classAmB2BMedia.png" usemap="#AmB2BMedia_map" alt=""/>
  <map id="AmB2BMedia_map" name="AmB2BMedia_map">
<area href="classAmMediaSession.html" alt="AmMediaSession" shape="rect" coords="0,0,109,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><b>AudioStreamPair</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><b>RelayStreamPair</b></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a267a8c41a0cd9e79b2614bc91ad603b2"></a><!-- doxytag: member="AmB2BMedia::AmB2BMedia" ref="a267a8c41a0cd9e79b2614bc91ad603b2" args="(AmB2BSession *_a, AmB2BSession *_b)" -->
&#160;</td><td class="memItemRight" valign="bottom"><b>AmB2BMedia</b> (<a class="el" href="classAmB2BSession.html">AmB2BSession</a> *_a, <a class="el" href="classAmB2BSession.html">AmB2BSession</a> *_b)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#ab94534c118507bea16b3e14d4010086e">addToMediaProcessor</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#af594a541784f34507a089b6ca36003dd">addToMediaProcessorUnsafe</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1255aafaa5196467021fe28d06645349"></a><!-- doxytag: member="AmB2BMedia::changeSession" ref="a1255aafaa5196467021fe28d06645349" args="(bool a_leg, AmB2BSession *new_session)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>changeSession</b> (bool a_leg, <a class="el" href="classAmB2BSession.html">AmB2BSession</a> *new_session)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a991a6b1d7405d7c1e8475b4fb37c5e66">addReference</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#ad9e862fe8e0d17cfe525c0e0917e53fe">releaseReference</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#aa8afae477eac3ec7ee6b68f8f5f4f2b2">replaceConnectionAddress</a> (<a class="el" href="classAmSdp.html">AmSdp</a> &amp;parser_sdp, bool a_leg, const string &amp;relay_address, const string &amp;relay_public_address)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a5a445f486f96378d4355507b36b97077">replaceOffer</a> (<a class="el" href="classAmSdp.html">AmSdp</a> &amp;sdp, bool a_leg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#ad50f99c58d07d212f10aa9d119a96bd5">updateStreams</a> (bool a_leg, const <a class="el" href="classAmSdp.html">AmSdp</a> &amp;local_sdp, const <a class="el" href="classAmSdp.html">AmSdp</a> &amp;remote_sdp, <a class="el" href="classRelayController.html">RelayController</a> *ctrl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a48d56d5216a458e4c4d813420855bd02">stop</a> (bool a_leg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a76a437d3a9a1998beb05da852b48dabe">readStreams</a> (unsigned long long ts, unsigned char *buffer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#ae0ebfc3de59cc154fd382eaa2c00eed1">writeStreams</a> (unsigned long long ts, unsigned char *buffer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a8da0298b22c60e492ab59c95139a05af">processDtmfEvents</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a63f0fc0b355a33bd9453e48326a8a947">sendDtmf</a> (bool a_leg, int event, unsigned int duration_ms)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a149b7540b4b2f0decf1111ced96a9bab">clearAudio</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a39254fb52fd8e198a6d68efa2f242f91">clearAudio</a> (bool a_leg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#aa97a7d5bd03acb9d472e7015227cdd49">clearRTPTimeout</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a0292ab1af686c590d6a13288bbb1290c">onMediaProcessingTerminated</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4b44ffcddf4bdd37d8c05c1eb222195f"></a><!-- doxytag: member="AmB2BMedia::mute" ref="a4b44ffcddf4bdd37d8c05c1eb222195f" args="(bool a_leg)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>mute</b> (bool a_leg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa59f10d712a22301793e3c6753eb526b"></a><!-- doxytag: member="AmB2BMedia::unmute" ref="aa59f10d712a22301793e3c6753eb526b" args="(bool a_leg)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>unmute</b> (bool a_leg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1995c769b089a328823100c8f7a22113"></a><!-- doxytag: member="AmB2BMedia::isMuted" ref="a1995c769b089a328823100c8f7a22113" args="(bool a_leg)" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><b>isMuted</b> (bool a_leg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9afb4c97db3db3ec35299675f8b79ab6"></a><!-- doxytag: member="AmB2BMedia::setFirstStreamInput" ref="a9afb4c97db3db3ec35299675f8b79ab6" args="(bool a_leg, AmAudio *in)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>setFirstStreamInput</b> (bool a_leg, <a class="el" href="classAmAudio.html">AmAudio</a> *in)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2d1eab9a2d710f4b49d2a97238106d93"></a><!-- doxytag: member="AmB2BMedia::createHoldAnswer" ref="a2d1eab9a2d710f4b49d2a97238106d93" args="(bool a_leg, const AmSdp &amp;offer, AmSdp &amp;answer, bool use_zero_con)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>createHoldAnswer</b> (bool a_leg, const <a class="el" href="classAmSdp.html">AmSdp</a> &amp;offer, <a class="el" href="classAmSdp.html">AmSdp</a> &amp;answer, bool use_zero_con)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae7d1af1e12ab2875e431e18d931a8f9b"></a><!-- doxytag: member="AmB2BMedia::setRtpLogger" ref="ae7d1af1e12ab2875e431e18d931a8f9b" args="(msg_logger *_logger)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>setRtpLogger</b> (<a class="el" href="classmsg__logger.html">msg_logger</a> *_logger)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a2ee7d06676717fb5b16ac0aef8ebc08f">setRelayDTMFReceiving</a> (bool enabled)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a0d4bac1b4f203a67a45ce6112464ad7e">pauseRelay</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#a1c403fffa6a1927d9f4ab4126e69d771">restartRelay</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmB2BMedia.html#af5161859ae297bcc0929b6d5d7b361cd">setReceiving</a> (bool receiving_a, bool receiving_b)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a078dda6c6dfb8d84a74a364bd76cc8f7"></a><!-- doxytag: member="AmB2BMedia::debug" ref="a078dda6c6dfb8d84a74a364bd76cc8f7" args="()" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>debug</b> ()</td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6f80441e197c07bc9e24c4a7d5e36388"></a><!-- doxytag: member="AmB2BMedia::canRelay" ref="a6f80441e197c07bc9e24c4a7d5e36388" args="(const SdpMedia &amp;m)" -->
static bool&#160;</td><td class="memItemRight" valign="bottom"><b>canRelay</b> (const <a class="el" href="structSdpMedia.html">SdpMedia</a> &amp;m)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Class for control over media relaying and transcoding in a B2B session. </p>
<p>This class manages RTP streams of both call legs, configures <a class="el" href="classAmRtpStream.html" title="RTP implementation.">AmRtpStream</a> relaying functionality and in case media needs to be transcoded its <a class="el" href="classAmMediaSession.html">AmMediaSession</a> interface implementation reads data from RTP streams in one leg and writes them to appropriate RTP streams of the other leg.</p>
<p>From the signaling part of the session (<a class="el" href="classAmB2BSession.html" title="Base class for Sessions in B2BUA mode.">AmB2BSession</a> instance for caller and for callee) it needs to be informed about local and remote SDP in each leg via updateLocalSdp() and updateRemoteSdp() methods.</p>
<p>Signaling parts of the session (caller and callee) needs to update outgoing SDP bodies by local address and ports of RTP streams using <a class="el" href="classAmB2BMedia.html#aa8afae477eac3ec7ee6b68f8f5f4f2b2">replaceConnectionAddress()</a> method.</p>
<p>Because generating B2B SDP is no more based on <a class="el" href="classAmSession.html" title="Implements the default behavior of one session.">AmSession</a>'s offer/answer mechanism but we relay remote's SDP with just slight changes (some payloads filtered out, some payloads added before forwarding) we don't need to remember payload ID mapping any more (local to remote). <a class="el" href="structPayload.html" title="represents one admissible payload type">Payload</a> IDs should be generated correctly by the remote party and we don't need to change it when relaying RTP packets.</p>
<p>TODO:</p>
<ul>
<li>handle offer/answer correctly (refused new offer means old offer/answer is still valid)</li>
<li>handle "on hold" streams - probably should be controlled by signaling (<a class="el" href="classAmB2BSession.html" title="Base class for Sessions in B2BUA mode.">AmB2BSession</a>) - either we should not send audio or we should send hold music</li>
</ul>
<p>Currently problematic, setting <a class="el" href="classAmRtpStream.html#ac011109c091a7fc98eb07d749f1e21b4">AmRtpStream::active</a> to false in <a class="el" href="classAmRtpStream.html#a6ef107d99bdfc91be7f26322fd1b00af">AmRtpStream::init</a> doesn't help always - if some RTP packets arrive later than media session is updated the stream remains 'active' (verified with SPA 942 and twinkle)</p>
<ul>
<li>non-audio streams - list of <a class="el" href="classAmRtpStream.html" title="RTP implementation.">AmRtpStream</a> pairs which can be just relayed</li>
</ul>
<ul>
<li>reference counting using atomic variables instead of locking</li>
</ul>
<ul>
<li>RTCP</li>
</ul>
<ul>
<li>correct sampling periods when relaying/transcoding according to values advertised in local SDP (i.e. the relayed one)</li>
</ul>
<ul>
<li>Is non-transparent SSRC &amp; seq. no needed if some payloads can be transcoded and some relayed? Couldn't be confusing to have transparent ones for relayed but our own SSRC &amp; seq. no for transcoded payloads? [wireshark seems to be confused] =&gt; disable transparent SSRC/seq.no if there are payloads for transcoding?</li>
</ul>
<p>Note that forcing our own SSRC can break things if the incomming RTP stream comes from a source mixing audio from different sources - in that case we should prefer to propagate SSRC (i.e. use transparent SSRC)!</p>
<ul>
<li>we should use our seq. numbers if transcoding is possible but propagate lost packets (i.e. remember the difference between received seq. numbers and sent ones and for the transcoding purpose use seq. number = max. already used number + 1)</li>
</ul>
<ul>
<li>configurable playout buffer type (from a test with transcoding PCMA -&gt; PCMU between SPA 942 and 941 it seems that at simulated 20% packet loss is the audio quality better with ADAPTIVE_PLAYOUT in comparison with SIMPLE_PLAYOUT but can't say it is really big differece)</li>
</ul>
<ul>
<li>In-band DTMF detection within relayed payloads not supported yet. Do we need it? </li>
</ul>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a991a6b1d7405d7c1e8475b4fb37c5e66"></a><!-- doxytag: member="AmB2BMedia::addReference" ref="a991a6b1d7405d7c1e8475b4fb37c5e66" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#a991a6b1d7405d7c1e8475b4fb37c5e66">AmB2BMedia::addReference</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Adds a reference.</p>
<p>Both AmB2BSessions and <a class="el" href="classAmMediaProcessor.html" title="Media processing thread manager.">AmMediaProcessor</a> uses refcnt to this class; B2BSession in case of RTP relay, <a class="el" href="classAmMediaProcessor.html" title="Media processing thread manager.">AmMediaProcessor</a> in case of local media processing.</p>
<p>Instance of this object is created with reference counter set to zero. Thus if somebody wants to hold a reference it must call <a class="el" href="classAmB2BMedia.html#a991a6b1d7405d7c1e8475b4fb37c5e66">addReference()</a> explicitly after construction! </p>

<p>Referenced by <a class="el" href="classAmB2BMedia.html#ab94534c118507bea16b3e14d4010086e">addToMediaProcessor()</a>.</p>

</div>
</div>
<a class="anchor" id="ab94534c118507bea16b3e14d4010086e"></a><!-- doxytag: member="AmB2BMedia::addToMediaProcessor" ref="ab94534c118507bea16b3e14d4010086e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#ab94534c118507bea16b3e14d4010086e">AmB2BMedia::addToMediaProcessor</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>To add a <a class="el" href="classAmB2BMedia.html" title="Class for control over media relaying and transcoding in a B2B session.">AmB2BMedia</a> session to the media processor, *this method MUST be used* as it increases the refcnt. </p>

<p>References <a class="el" href="classAmB2BMedia.html#a991a6b1d7405d7c1e8475b4fb37c5e66">addReference()</a>, and <a class="el" href="classAmMediaProcessor.html#a84a86400acc138da77fd2d87bea50e6f">AmMediaProcessor::addSession()</a>.</p>

</div>
</div>
<a class="anchor" id="af594a541784f34507a089b6ca36003dd"></a><!-- doxytag: member="AmB2BMedia::addToMediaProcessorUnsafe" ref="af594a541784f34507a089b6ca36003dd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#af594a541784f34507a089b6ca36003dd">AmB2BMedia::addToMediaProcessorUnsafe</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>unsafe version (no locking of mutex)</p>
<p>To add a <a class="el" href="classAmB2BMedia.html" title="Class for control over media relaying and transcoding in a B2B session.">AmB2BMedia</a> session to the media processor, *this method MUST be used* as it increases the refcnt. </p>

<p>References <a class="el" href="classAmMediaProcessor.html#a84a86400acc138da77fd2d87bea50e6f">AmMediaProcessor::addSession()</a>.</p>

</div>
</div>
<a class="anchor" id="a149b7540b4b2f0decf1111ced96a9bab"></a><!-- doxytag: member="AmB2BMedia::clearAudio" ref="a149b7540b4b2f0decf1111ced96a9bab" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="classAmB2BMedia.html#a149b7540b4b2f0decf1111ced96a9bab">AmB2BMedia::clearAudio</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Release all RTP streams of both legs and both AmB2BSessions as well.</p>
<p>Though <a class="el" href="classAmB2BMedia.html#a76a437d3a9a1998beb05da852b48dabe">readStreams()</a>, <a class="el" href="classAmB2BMedia.html#ae0ebfc3de59cc154fd382eaa2c00eed1">writeStreams()</a> or <a class="el" href="classAmB2BMedia.html#a8da0298b22c60e492ab59c95139a05af">processDtmfEvents()</a> can be called after call to clearAudio, they will do nothing because all relevant information will be rlready eleased. </p>

<p>Implements <a class="el" href="classAmMediaSession.html#ab31da8969417f45a6fb64f3b3ad23f39">AmMediaSession</a>.</p>

<p>References <a class="el" href="classAmB2BMedia.html#a149b7540b4b2f0decf1111ced96a9bab">clearAudio()</a>.</p>

<p>Referenced by <a class="el" href="classAmB2BMedia.html#a149b7540b4b2f0decf1111ced96a9bab">clearAudio()</a>, and <a class="el" href="classAmB2BMedia.html#a48d56d5216a458e4c4d813420855bd02">stop()</a>.</p>

</div>
</div>
<a class="anchor" id="a39254fb52fd8e198a6d68efa2f242f91"></a><!-- doxytag: member="AmB2BMedia::clearAudio" ref="a39254fb52fd8e198a6d68efa2f242f91" args="(bool a_leg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#a149b7540b4b2f0decf1111ced96a9bab">AmB2BMedia::clearAudio</a> </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>a_leg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>release RTP streams for one leg </p>

</div>
</div>
<a class="anchor" id="aa97a7d5bd03acb9d472e7015227cdd49"></a><!-- doxytag: member="AmB2BMedia::clearRTPTimeout" ref="aa97a7d5bd03acb9d472e7015227cdd49" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#aa97a7d5bd03acb9d472e7015227cdd49">AmB2BMedia::clearRTPTimeout</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Clear RTP timeout of all streams in both call legs. </p>

<p>Implements <a class="el" href="classAmMediaSession.html#acd82ab4631a2182e36225392ab5b19bf">AmMediaSession</a>.</p>

</div>
</div>
<a class="anchor" id="a0292ab1af686c590d6a13288bbb1290c"></a><!-- doxytag: member="AmB2BMedia::onMediaProcessingTerminated" ref="a0292ab1af686c590d6a13288bbb1290c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#a0292ab1af686c590d6a13288bbb1290c">AmB2BMedia::onMediaProcessingTerminated</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Callback function called once media processor releases this instance from processing loop.</p>
<p>Deletes itself if there are no other references! FIXME: might be returning something like "release me" and calling delete from media processor would be better? </p>

<p>Reimplemented from <a class="el" href="classAmMediaSession.html">AmMediaSession</a>.</p>

<p>References <a class="el" href="classAmB2BMedia.html#ad9e862fe8e0d17cfe525c0e0917e53fe">releaseReference()</a>.</p>

</div>
</div>
<a class="anchor" id="a0d4bac1b4f203a67a45ce6112464ad7e"></a><!-- doxytag: member="AmB2BMedia::pauseRelay" ref="a0d4bac1b4f203a67a45ce6112464ad7e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#a0d4bac1b4f203a67a45ce6112464ad7e">AmB2BMedia::pauseRelay</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>pause relaying on streams </p>

</div>
</div>
<a class="anchor" id="a8da0298b22c60e492ab59c95139a05af"></a><!-- doxytag: member="AmB2BMedia::processDtmfEvents" ref="a8da0298b22c60e492ab59c95139a05af" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#a8da0298b22c60e492ab59c95139a05af">AmB2BMedia::processDtmfEvents</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Calls processDtmfEvent on both AmB2BSessions for which this <a class="el" href="classAmB2BMedia.html" title="Class for control over media relaying and transcoding in a B2B session.">AmB2BMedia</a> instance manages media. </p>

<p>Implements <a class="el" href="classAmMediaSession.html#a6fa8e15941611f6b961bf51ffc802c57">AmMediaSession</a>.</p>

</div>
</div>
<a class="anchor" id="a76a437d3a9a1998beb05da852b48dabe"></a><!-- doxytag: member="AmB2BMedia::readStreams" ref="a76a437d3a9a1998beb05da852b48dabe" args="(unsigned long long ts, unsigned char *buffer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual int <a class="el" href="classAmB2BMedia.html#a76a437d3a9a1998beb05da852b48dabe">AmB2BMedia::readStreams</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned long long&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Should read from all streams before writing to the other streams.</p>
<p>Because processing is driven by destination stream (i.e. we don't read anything unless the destination stream is ready to send something - see sendIntReached()) all processing is done in writeStreams </p>

<p>Implements <a class="el" href="classAmMediaSession.html#a5d3ddc0cef7f238621fb95ca00c4a214">AmMediaSession</a>.</p>

</div>
</div>
<a class="anchor" id="ad9e862fe8e0d17cfe525c0e0917e53fe"></a><!-- doxytag: member="AmB2BMedia::releaseReference" ref="ad9e862fe8e0d17cfe525c0e0917e53fe" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classAmB2BMedia.html#ad9e862fe8e0d17cfe525c0e0917e53fe">AmB2BMedia::releaseReference</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Releases reference.</p>
<p>Returns true if this was the last reference, in that case the pointer to that object is now *invalid* Must be last operation in member method! </p>

<p>Referenced by <a class="el" href="classAmB2BSession.html#a8e59033756f0fb3edcdd2a221129dc30">AmB2BSession::clearRtpReceiverRelay()</a>, and <a class="el" href="classAmB2BMedia.html#a0292ab1af686c590d6a13288bbb1290c">onMediaProcessingTerminated()</a>.</p>

</div>
</div>
<a class="anchor" id="aa8afae477eac3ec7ee6b68f8f5f4f2b2"></a><!-- doxytag: member="AmB2BMedia::replaceConnectionAddress" ref="aa8afae477eac3ec7ee6b68f8f5f4f2b2" args="(AmSdp &amp;parser_sdp, bool a_leg, const string &amp;relay_address, const string &amp;relay_public_address)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#aa8afae477eac3ec7ee6b68f8f5f4f2b2">AmB2BMedia::replaceConnectionAddress</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classAmSdp.html">AmSdp</a> &amp;&#160;</td>
          <td class="paramname"><em>parser_sdp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>a_leg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>relay_address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>relay_public_address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Replace connection address and ports within SDP.</p>
<p>Throws an exception (string) in case of error. (FIXME?) </p>

<p>References <a class="el" href="structSdpConnection.html#a5e3452669696521758ce5535796e136f">SdpConnection::address</a>, and <a class="el" href="AmUtils_8cpp.html#ac46bbc121c4737c1241555a6b7f0e05a">int2str()</a>.</p>

<p>Referenced by <a class="el" href="classAmB2BSession.html#a02858439beed4b19bc97ae7f3afc3859">AmB2BSession::updateLocalSdp()</a>.</p>

</div>
</div>
<a class="anchor" id="a5a445f486f96378d4355507b36b97077"></a><!-- doxytag: member="AmB2BMedia::replaceOffer" ref="a5a445f486f96378d4355507b36b97077" args="(AmSdp &amp;sdp, bool a_leg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classAmB2BMedia.html#a5a445f486f96378d4355507b36b97077">AmB2BMedia::replaceOffer</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classAmSdp.html">AmSdp</a> &amp;&#160;</td>
          <td class="paramname"><em>sdp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>a_leg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>replace offer inside given SDP with locally generated one (media streams etc must be initialised like in case replaceConnectionAddress) </p>

</div>
</div>
<a class="anchor" id="a1c403fffa6a1927d9f4ab4126e69d771"></a><!-- doxytag: member="AmB2BMedia::restartRelay" ref="a1c403fffa6a1927d9f4ab4126e69d771" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#a1c403fffa6a1927d9f4ab4126e69d771">AmB2BMedia::restartRelay</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>restart relaying on streams </p>

</div>
</div>
<a class="anchor" id="a63f0fc0b355a33bd9453e48326a8a947"></a><!-- doxytag: member="AmB2BMedia::sendDtmf" ref="a63f0fc0b355a33bd9453e48326a8a947" args="(bool a_leg, int event, unsigned int duration_ms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#a63f0fc0b355a33bd9453e48326a8a947">AmB2BMedia::sendDtmf</a> </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>a_leg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>duration_ms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sends DTMF using the given call leg </p>

<p>Referenced by <a class="el" href="classSBCCallLeg.html#a69a73878081fc38f975355099d5b3f0f">SBCCallLeg::onDtmf()</a>.</p>

</div>
</div>
<a class="anchor" id="af5161859ae297bcc0929b6d5d7b361cd"></a><!-- doxytag: member="AmB2BMedia::setReceiving" ref="af5161859ae297bcc0929b6d5d7b361cd" args="(bool receiving_a, bool receiving_b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#af5161859ae297bcc0929b6d5d7b361cd">AmB2BMedia::setReceiving</a> </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>receiving_a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>receiving_b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>set 'receving' property of RTP/relay streams (not receiving=drop incoming packets)</p>
<p>set receving of RTP/relay streams (not receiving=drop incoming packets) </p>

</div>
</div>
<a class="anchor" id="a2ee7d06676717fb5b16ac0aef8ebc08f"></a><!-- doxytag: member="AmB2BMedia::setRelayDTMFReceiving" ref="a2ee7d06676717fb5b16ac0aef8ebc08f" args="(bool enabled)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#a2ee7d06676717fb5b16ac0aef8ebc08f">AmB2BMedia::setRelayDTMFReceiving</a> </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>enabled</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>enable or disable DTMF receiving on relay streams </p>

</div>
</div>
<a class="anchor" id="a48d56d5216a458e4c4d813420855bd02"></a><!-- doxytag: member="AmB2BMedia::stop" ref="a48d56d5216a458e4c4d813420855bd02" args="(bool a_leg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#a48d56d5216a458e4c4d813420855bd02">AmB2BMedia::stop</a> </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>a_leg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Clear audio for given leg and stop processing if both legs stopped.</p>
<p>Releases all RTP streams and removes itself from media processor if still there. </p>

<p>References <a class="el" href="classAmB2BMedia.html#a149b7540b4b2f0decf1111ced96a9bab">clearAudio()</a>, <a class="el" href="classAmMediaSession.html#a45856da3db0d353e7243bad46a9a2059">AmMediaSession::isProcessingMedia()</a>, and <a class="el" href="classAmMediaProcessor.html#adab9167ea52d42904c081a1ced0be49d">AmMediaProcessor::removeSession()</a>.</p>

<p>Referenced by <a class="el" href="classAmB2BSession.html#a8e59033756f0fb3edcdd2a221129dc30">AmB2BSession::clearRtpReceiverRelay()</a>.</p>

</div>
</div>
<a class="anchor" id="ad50f99c58d07d212f10aa9d119a96bd5"></a><!-- doxytag: member="AmB2BMedia::updateStreams" ref="ad50f99c58d07d212f10aa9d119a96bd5" args="(bool a_leg, const AmSdp &amp;local_sdp, const AmSdp &amp;remote_sdp, RelayController *ctrl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classAmB2BMedia.html#ad50f99c58d07d212f10aa9d119a96bd5">AmB2BMedia::updateStreams</a> </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>a_leg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classAmSdp.html">AmSdp</a> &amp;&#160;</td>
          <td class="paramname"><em>local_sdp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classAmSdp.html">AmSdp</a> &amp;&#160;</td>
          <td class="paramname"><em>remote_sdp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRelayController.html">RelayController</a> *&#160;</td>
          <td class="paramname"><em>ctrl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Update media session with local &amp; remote SDP. </p>

<p>References <a class="el" href="structSdpConnection.html#a5e3452669696521758ce5535796e136f">SdpConnection::address</a>.</p>

<p>Referenced by <a class="el" href="classAmB2BSession.html#aa636764d855df589909065bbc1f1be10">AmB2BSession::onSdpCompleted()</a>.</p>

</div>
</div>
<a class="anchor" id="ae0ebfc3de59cc154fd382eaa2c00eed1"></a><!-- doxytag: member="AmB2BMedia::writeStreams" ref="ae0ebfc3de59cc154fd382eaa2c00eed1" args="(unsigned long long ts, unsigned char *buffer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classAmB2BMedia.html#ae0ebfc3de59cc154fd382eaa2c00eed1">AmB2BMedia::writeStreams</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned long long&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read and write all RTP streams if data are to be written (see <a class="el" href="classAmB2BMedia.html#a76a437d3a9a1998beb05da852b48dabe">readStreams()</a>). </p>

<p>Implements <a class="el" href="classAmMediaSession.html#a7c7ab481a135ffd44d5d193607646513">AmMediaSession</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="AmB2BMedia_8h_source.html">AmB2BMedia.h</a></li>
<li>AmB2BMedia.cpp</li>
</ul>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
