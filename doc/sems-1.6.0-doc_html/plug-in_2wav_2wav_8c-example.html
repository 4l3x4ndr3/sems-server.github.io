<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SEMS: plug-in/wav/wav.c</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">SEMS
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">plug-in/wav/wav.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment"> * Copyright (C) 2002-2003 Fhg Fokus</span>
<span class="comment"> *</span>
<span class="comment"> * This file is part of SEMS, a free SIP media server.</span>
<span class="comment"> *</span>
<span class="comment"> * SEMS is free software; you can redistribute it and/or modify</span>
<span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="comment"> * (at your option) any later version. This program is released under</span>
<span class="comment"> * the GPL with the additional exemption that compiling, linking,</span>
<span class="comment"> * and/or using OpenSSL is allowed.</span>
<span class="comment"> *</span>
<span class="comment"> * For a license to use the SEMS software under conditions</span>
<span class="comment"> * other than those described here, or to purchase support for this</span>
<span class="comment"> * software, please contact iptel.org by e-mail at the following addresses:</span>
<span class="comment"> *    info@iptel.org</span>
<span class="comment"> *</span>
<span class="comment"> * SEMS is distributed in the hope that it will be useful,</span>
<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> * GNU General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> * You should have received a copy of the GNU General Public License </span>
<span class="comment"> * along with this program; if not, write to the Free Software </span>
<span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &quot;<a class="code" href="amci_8h.html" title="Definition of the codec interface.">amci.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="codecs_8h.html">codecs.h</a>&quot;</span>
<span class="preprocessor">#include &quot;g711.h&quot;</span>
<span class="preprocessor">#include &quot;wav_hdr.h&quot;</span>
<span class="preprocessor">#include &quot;../../log.h&quot;</span>

<span class="preprocessor">#define WAV_PCM  1 </span>
<span class="preprocessor"></span>
<span class="preprocessor">#define WAV_ALAW 6 </span>
<span class="preprocessor"></span>
<span class="preprocessor">#define WAV_ULAW 7 </span>
<span class="preprocessor"></span>
<span class="keyword">static</span> <span class="keywordtype">int</span> ULaw_2_Pcm16( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* out_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* in_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size,
                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channels, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rate, <span class="keywordtype">long</span> h_codec );

<span class="keyword">static</span> <span class="keywordtype">int</span> ALaw_2_Pcm16( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* out_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* in_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size,
                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channels, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rate, <span class="keywordtype">long</span> h_codec );

<span class="keyword">static</span> <span class="keywordtype">int</span> Pcm16_2_ULaw( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* out_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* in_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size,
                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channels, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rate, <span class="keywordtype">long</span> h_codec );

<span class="keyword">static</span> <span class="keywordtype">int</span> Pcm16_2_ALaw( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* out_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* in_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size,
                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channels, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rate, <span class="keywordtype">long</span> h_codec );

<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> g711_bytes2samples(<span class="keywordtype">long</span>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>);
<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> g711_samples2bytes(<span class="keywordtype">long</span>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>);

<a name="a0"></a><a class="code" href="amci_8h.html#a530213df7af61808a3a2e01ea0168a1b">BEGIN_EXPORTS</a>( <span class="stringliteral">&quot;wav&quot;</span> , AMCI_NO_MODULEINIT, AMCI_NO_MODULEDESTROY )

     <a name="a1"></a><a class="code" href="amci_8h.html#a11577f95b44271011ca520ddadd9a7d6">BEGIN_CODECS</a>
      <a name="a2"></a><a class="code" href="amci_8h.html#a4d5a8988351316e96e5238bcae7c98ed">CODEC</a>( CODEC_ULAW, Pcm16_2_ULaw, ULaw_2_Pcm16,
             AMCI_NO_CODEC_PLC, AMCI_NO_CODECCREATE, AMCI_NO_CODECDESTROY,
             g711_bytes2samples, g711_samples2bytes )
      <a class="code" href="amci_8h.html#a4d5a8988351316e96e5238bcae7c98ed">CODEC</a>( CODEC_ALAW, Pcm16_2_ALaw, ALaw_2_Pcm16,
             AMCI_NO_CODEC_PLC, AMCI_NO_CODECCREATE, AMCI_NO_CODECDESTROY,
             g711_bytes2samples, g711_samples2bytes )
     <a name="a3"></a><a class="code" href="amci_8h.html#a1acfffe3c7910d77317b3b2a0237182e">END_CODECS</a>
    
     <a name="a4"></a><a class="code" href="amci_8h.html#ae63691047925c74d17ecd3b317a3baea">BEGIN_PAYLOADS</a>
        <a name="a5"></a><a class="code" href="amci_8h.html#a43636dcf8be8cd10ca21812d0514b3fb">PAYLOAD</a>( 0, &quot;PCMU&quot;, 8000, 8000, 1, CODEC_ULAW, <a name="a6"></a><a class="code" href="amci_8h.html#a7dd84d438b6cdf4b0a7ada1c6afbc2fe">AMCI_PT_AUDIO_LINEAR</a> )
        PAYLOAD( 8, &quot;PCMA&quot;, 8000, 8000, 1, CODEC_ALAW, <a class="code" href="amci_8h.html#a7dd84d438b6cdf4b0a7ada1c6afbc2fe">AMCI_PT_AUDIO_LINEAR</a> )
     <a name="a7"></a><a class="code" href="amci_8h.html#a9f20b1b94e1361170c4bbdaa4baa84e9">END_PAYLOADS</a>

     <a name="a8"></a><a class="code" href="amci_8h.html#a8e06186d28d941d515ef7ae08885515a">BEGIN_FILE_FORMATS</a>
       <a name="a9"></a><a class="code" href="amci_8h.html#a9cf01e796af0a8b730e6c8cf7cb159b1">BEGIN_FILE_FORMAT</a>( &quot;Wav&quot;, &quot;wav&quot;, &quot;audio/x-wav&quot;, wav_open, wav_close, wav_mem_open, wav_mem_close)
         <a name="a10"></a><a class="code" href="amci_8h.html#a6f28be9c5578a656ea7d7c7de46ef73b">BEGIN_SUBTYPES</a>
           <a name="a11"></a><a class="code" href="amci_8h.html#aed5814ddd8b9388042efe1a8ab8482cf">SUBTYPE</a>( WAV_PCM,  &quot;Pcm16&quot;,  8000, 1, CODEC_PCM16 ) <span class="comment">// we only support 8000/1 channel !</span>
           <a class="code" href="amci_8h.html#aed5814ddd8b9388042efe1a8ab8482cf">SUBTYPE</a>( WAV_ALAW, &quot;A-Law&quot;,  8000, 1, CODEC_ALAW )
           <a class="code" href="amci_8h.html#aed5814ddd8b9388042efe1a8ab8482cf">SUBTYPE</a>( WAV_ULAW, &quot;Mu-Law&quot;, 8000, 1, CODEC_ULAW )
         <a name="a12"></a><a class="code" href="amci_8h.html#a3f5299506e795c924f8e49a2a612b5b7">END_SUBTYPES</a>
       <a name="a13"></a><a class="code" href="amci_8h.html#a1d72402a250b41c4cfe9579063f410df">END_FILE_FORMAT</a>
     <a name="a14"></a><a class="code" href="amci_8h.html#ac70ebb86cec32cb818196acb0b786abb">END_FILE_FORMATS</a>

<a name="a15"></a><a class="code" href="amci_8h.html#affa8c26c166d3a445a93abe24ca59b16">END_EXPORTS</a>

static <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> g711_bytes2samples(<span class="keywordtype">long</span> h_codec, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_bytes)
{
  <span class="comment">/* ALAW and ULAW formats has one sample per byte */</span>
  <span class="keywordflow">return</span> num_bytes;
}

<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> g711_samples2bytes(<span class="keywordtype">long</span> h_codec, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_samples)
{
  <span class="comment">/* ALAW and ULAW formats has one sample per byte */</span>
  <span class="keywordflow">return</span> num_samples;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> ULaw_2_Pcm16( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* out_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* in_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size,
                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channels, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rate, <span class="keywordtype">long</span> h_codec )
{
  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* out_b = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>*)out_buf;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*  in_b  = in_buf;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*  end   = in_b + size;

  <span class="keywordflow">while</span>(in_b != end){
    <span class="comment">//  int i = st_ulaw2linear16(*(in_b++));</span>
    <span class="comment">//  *(out_b++) = i;</span>
    *(out_b++) = st_ulaw2linear16(*(in_b++));
  }
  <span class="keywordflow">return</span> size*2;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> ALaw_2_Pcm16( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* out_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* in_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size,
                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channels, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rate, <span class="keywordtype">long</span> h_codec )
{
  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>* out_b = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>*)out_buf;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*  in_b  = in_buf;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*  end   = in_b + size;

  <span class="keywordflow">while</span>(in_b != end){
    <span class="comment">//  int i = st_alaw2linear16(*(in_b++));</span>
    <span class="comment">//  *(out_b++) = i;</span>
    *(out_b++) = st_alaw2linear16(*(in_b++));
  }
  <span class="keywordflow">return</span> size*2;
}

<span class="keywordtype">int</span> Pcm16_2_ULaw( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* out_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* in_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size,
                  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channels, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rate, <span class="keywordtype">long</span> h_codec )
{
  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* out_b = out_buf;
  <span class="keywordtype">short</span>* in_b          = (<span class="keywordtype">short</span>*)(in_buf);
  <span class="keywordtype">short</span>* end           = (<span class="keywordtype">short</span>*)((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)in_buf + size);

  <span class="keywordflow">while</span>(in_b != end){
    <span class="keywordtype">short</span> s = *(in_b++) &gt;&gt; 2;
    *(out_b++) = st_14linear2ulaw(s);
  }
  <span class="keywordflow">return</span> size/2;
}

<span class="keywordtype">int</span> Pcm16_2_ALaw( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* out_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* in_buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size,
                  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> channels, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rate, <span class="keywordtype">long</span> h_codec )
{
  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* out_b = out_buf;
  <span class="keywordtype">short</span>* in_b          = (<span class="keywordtype">short</span>*)(in_buf);
  <span class="keywordtype">short</span>* end           = (<span class="keywordtype">short</span>*)((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)in_buf + size);

  <span class="keywordflow">while</span>(in_b != end){
    <span class="keywordtype">short</span> s = (*(in_b++)) &gt;&gt; 3;
    *(out_b++) = st_13linear2alaw(s);
  }

  <span class="keywordflow">return</span> size/2;
}


</pre></div> </div><!-- contents -->
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
