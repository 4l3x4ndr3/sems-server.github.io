<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SEMS: AmMediaSession Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">SEMS
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">AmMediaSession Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="AmMediaSession" -->
<p><code>#include &lt;<a class="el" href="AmMediaProcessor_8h_source.html">AmMediaProcessor.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for AmMediaSession:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classAmMediaSession.png" usemap="#AmMediaSession_map" alt=""/>
  <map id="AmMediaSession_map" name="AmMediaSession_map">
<area href="classAmB2BMedia.html" title="Class for control over media relaying and transcoding in a B2B session." alt="AmB2BMedia" shape="rect" coords="0,56,162,80"/>
<area href="classAmSession.html" title="Implements the default behavior of one session." alt="AmSession" shape="rect" coords="172,56,334,80"/>
<area href="classAmB2ABSession.html" title="Base class for Sessions in B2ABUA mode." alt="AmB2ABSession" shape="rect" coords="344,112,506,136"/>
<area href="classAmB2BSession.html" title="Base class for Sessions in B2BUA mode." alt="AmB2BSession" shape="rect" coords="344,168,506,192"/>
<area href="classAnnounceAuthDialog.html" alt="AnnounceAuthDialog" shape="rect" coords="344,224,506,248"/>
<area href="classAnnouncementDialog.html" title="announcement session logic implementation" alt="AnnouncementDialog" shape="rect" coords="344,280,506,304"/>
<area href="classAnnounceTransferDialog.html" title="session logic implementation for announce_transfer sessions" alt="AnnounceTransferDialog" shape="rect" coords="344,336,506,360"/>
<area href="classAnnRecorderDialog.html" title="announcement session logic implementation" alt="AnnRecorderDialog" shape="rect" coords="344,392,506,416"/>
<area href="classAnswerMachineDialog.html" alt="AnswerMachineDialog" shape="rect" coords="344,448,506,472"/>
<area href="classCacheAnnounceDialog.html" alt="CacheAnnounceDialog" shape="rect" coords="344,504,506,528"/>
<area href="classCallGenDialog.html" alt="CallGenDialog" shape="rect" coords="344,560,506,584"/>
<area href="classConferenceDialog.html" title="session logic implementation of conference sessions" alt="ConferenceDialog" shape="rect" coords="344,616,506,640"/>
<area href="classDtmfTesterDialog.html" title="announcement session logic implementation" alt="DtmfTesterDialog" shape="rect" coords="344,672,506,696"/>
<area href="classEarlyRecordDialog.html" alt="EarlyRecordDialog" shape="rect" coords="344,728,506,752"/>
<area href="classEchoDialog.html" title="echo session logic implementation" alt="EchoDialog" shape="rect" coords="344,784,506,808"/>
<area href="classEventProxySession.html" alt="EventProxySession" shape="rect" coords="344,840,506,864"/>
<area href="classGWSession.html" alt="GWSession" shape="rect" coords="344,896,506,920"/>
<area href="classMyAnnounceAppDialog.html" alt="MyAnnounceAppDialog" shape="rect" coords="344,952,506,976"/>
<area href="classMyAppDialog.html" alt="MyAppDialog" shape="rect" coords="344,1008,506,1032"/>
<area href="classMyAppDialog.html" alt="MyAppDialog" shape="rect" coords="344,1064,506,1088"/>
<area href="classMyConfigurableAppDialog.html" alt="MyConfigurableAppDialog" shape="rect" coords="344,1120,506,1144"/>
<area href="classMyJukeboxDialog.html" alt="MyJukeboxDialog" shape="rect" coords="344,1176,506,1200"/>
<area href="classPinAuthConferenceDialog.html" alt="PinAuthConferenceDialog" shape="rect" coords="344,1232,506,1256"/>
<area href="classPrecodedDialog.html" alt="PrecodedDialog" shape="rect" coords="344,1288,506,1312"/>
<area href="classPySemsDialog.html" title="implementation of session logic/script execution in pySems" alt="PySemsDialog" shape="rect" coords="344,1344,506,1368"/>
<area href="classRtmpSession.html" alt="RtmpSession" shape="rect" coords="344,1400,506,1424"/>
<area href="classSimpleConferenceDialog.html" alt="SimpleConferenceDialog" shape="rect" coords="344,1456,506,1480"/>
<area href="classVoiceboxDialog.html" alt="VoiceboxDialog" shape="rect" coords="344,1512,506,1536"/>
<area href="classWebConferenceDialog.html" alt="WebConferenceDialog" shape="rect" coords="344,1568,506,1592"/>
</map>
 </div></div>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmMediaSession.html#a5d3ddc0cef7f238621fb95ca00c4a214">readStreams</a> (unsigned long long ts, unsigned char *buffer)=0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmMediaSession.html#a7c7ab481a135ffd44d5d193607646513">writeStreams</a> (unsigned long long ts, unsigned char *buffer)=0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmMediaSession.html#a6fa8e15941611f6b961bf51ffc802c57">processDtmfEvents</a> ()=0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmMediaSession.html#ab31da8969417f45a6fb64f3b3ad23f39">clearAudio</a> ()=0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmMediaSession.html#acd82ab4631a2182e36225392ab5b19bf">clearRTPTimeout</a> ()=0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmMediaSession.html#ad57514cbbac6b0d05e97c01a55286038">onMediaProcessingStarted</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad032b77d53a8988c46e3e5751d6b2a64"></a><!-- doxytag: member="AmMediaSession::onMediaProcessingTerminated" ref="ad032b77d53a8988c46e3e5751d6b2a64" args="()" -->
virtual void&#160;</td><td class="memItemRight" valign="bottom"><b>onMediaProcessingTerminated</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmMediaSession.html#a45856da3db0d353e7243bad46a9a2059">isProcessingMedia</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classAmMediaSession.html#adf0ae916e8f7f560d8f381621294c3fa">isDetached</a> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Interface for basic media session processing.</p>
<p>Media processor stores set of objects implementing this interface and periodically triggers media processing on each of them.</p>
<p>First it calls <a class="el" href="classAmMediaSession.html#a5d3ddc0cef7f238621fb95ca00c4a214">readStreams()</a> method on all managed media sessions to read from all streams first and then calls <a class="el" href="classAmMediaSession.html#a7c7ab481a135ffd44d5d193607646513">writeStreams()</a> to send data out in all these sessions.</p>
<p>Once audio processing of all media sessions is done, media processor walks through them once more and calls <a class="el" href="classAmMediaSession.html#a6fa8e15941611f6b961bf51ffc802c57">processDtmfEvents()</a> on them to handle DTMF events detected when reading data from media streams. </p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ab31da8969417f45a6fb64f3b3ad23f39"></a><!-- doxytag: member="AmMediaSession::clearAudio" ref="ab31da8969417f45a6fb64f3b3ad23f39" args="()=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="classAmMediaSession.html#ab31da8969417f45a6fb64f3b3ad23f39">AmMediaSession::clearAudio</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reset all media processing elements.</p>
<p>Called as part of cleanup when removing session from media processor upon an processing error (either <a class="el" href="classAmMediaSession.html#a5d3ddc0cef7f238621fb95ca00c4a214">readStreams()</a> or <a class="el" href="classAmMediaSession.html#a7c7ab481a135ffd44d5d193607646513">writeStreams()</a> returning error). </p>

<p>Implemented in <a class="el" href="classAmB2BMedia.html#a149b7540b4b2f0decf1111ced96a9bab">AmB2BMedia</a>, <a class="el" href="classAmSession.html#aad988b8fbd9298111d673fed35270b4c">AmSession</a>, and <a class="el" href="classWebConferenceDialog.html#ad759ab5ee8b85c58ce2942bc16d0e2da">WebConferenceDialog</a>.</p>

</div>
</div>
<a class="anchor" id="acd82ab4631a2182e36225392ab5b19bf"></a><!-- doxytag: member="AmMediaSession::clearRTPTimeout" ref="acd82ab4631a2182e36225392ab5b19bf" args="()=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="classAmMediaSession.html#acd82ab4631a2182e36225392ab5b19bf">AmMediaSession::clearRTPTimeout</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reset timeouts of all RTP streams related to this media session.</p>
<p>Called during initialization when session starts to be processed by media processor. </p>

<p>Implemented in <a class="el" href="classAmSession.html#aeed92b3df398866ac9f62adb47e7af59">AmSession</a>, and <a class="el" href="classAmB2BMedia.html#aa97a7d5bd03acb9d472e7015227cdd49">AmB2BMedia</a>.</p>

</div>
</div>
<a class="anchor" id="adf0ae916e8f7f560d8f381621294c3fa"></a><!-- doxytag: member="AmMediaSession::isDetached" ref="adf0ae916e8f7f560d8f381621294c3fa" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual bool <a class="el" href="classAmMediaSession.html#adf0ae916e8f7f560d8f381621294c3fa">AmMediaSession::isDetached</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Indicates if the object is used by media processor.</p>
<p>Seems to be duplicate to <a class="el" href="classAmMediaSession.html#a45856da3db0d353e7243bad46a9a2059">isProcessingMedia()</a>. It was kept to reduce number of changes in existing code. </p>

<p>References <a class="el" href="classAmMediaSession.html#a45856da3db0d353e7243bad46a9a2059">isProcessingMedia()</a>.</p>

</div>
</div>
<a class="anchor" id="a45856da3db0d353e7243bad46a9a2059"></a><!-- doxytag: member="AmMediaSession::isProcessingMedia" ref="a45856da3db0d353e7243bad46a9a2059" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual bool <a class="el" href="classAmMediaSession.html#a45856da3db0d353e7243bad46a9a2059">AmMediaSession::isProcessingMedia</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Indicates if the object is used by media processor.</p>
<p>Returns value of internal variable for distinguishing if the object is already added into media processor. It should be avoided to insert one session into media processor multiple times.</p>
<p>Note that using default implementation of onMediaProcessingStarted and onMediaProcessingTerminated is required for proper function. </p>

<p>Referenced by <a class="el" href="classAmMediaSession.html#adf0ae916e8f7f560d8f381621294c3fa">isDetached()</a>, <a class="el" href="classAmSession.html#ae8104f2197534e0e0dc2df72ab6ebf7a">AmSession::onSdpCompleted()</a>, <a class="el" href="classAmSession.html#a46a85bb8417b1eb177a89ae429714d5b">AmSession::startMediaProcessing()</a>, <a class="el" href="classAmB2BMedia.html#a48d56d5216a458e4c4d813420855bd02">AmB2BMedia::stop()</a>, and <a class="el" href="classAmSession.html#ab80c377e4df759b7cb3a85c00d58b405">AmSession::stopMediaProcessing()</a>.</p>

</div>
</div>
<a class="anchor" id="ad57514cbbac6b0d05e97c01a55286038"></a><!-- doxytag: member="AmMediaSession::onMediaProcessingStarted" ref="ad57514cbbac6b0d05e97c01a55286038" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="classAmMediaSession.html#ad57514cbbac6b0d05e97c01a55286038">AmMediaSession::onMediaProcessingStarted</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Callback function called when a session is added to media processor.</p>
<p>Default implementation sets internal variable usable for detection if the object is in use by <a class="el" href="classAmMediaProcessorThread.html" title="Media processing thread.">AmMediaProcessorThread</a>. </p>

<p>References <a class="el" href="classAmCondition.html#afcba52becdbdb85bb60f8b4f47a449e9">AmCondition&lt; T &gt;::set()</a>.</p>

<p>Referenced by <a class="el" href="classAmMediaProcessor.html#a84a86400acc138da77fd2d87bea50e6f">AmMediaProcessor::addSession()</a>.</p>

</div>
</div>
<a class="anchor" id="a6fa8e15941611f6b961bf51ffc802c57"></a><!-- doxytag: member="AmMediaSession::processDtmfEvents" ref="a6fa8e15941611f6b961bf51ffc802c57" args="()=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="classAmMediaSession.html#a6fa8e15941611f6b961bf51ffc802c57">AmMediaSession::processDtmfEvents</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle events in DTMF event queue.</p>
<p>DTMF events should be detected from RTP stream when reading data (see <a class="el" href="classAmMediaSession.html#a5d3ddc0cef7f238621fb95ca00c4a214">readStreams()</a>) and put into an event queue for later processing to avoid blocking of audio processing for too long time.</p>
<p>This DTMF event queue should be processed then, within this method, which is triggered by <a class="el" href="classAmMediaProcessorThread.html" title="Media processing thread.">AmMediaProcessorThread</a> once reading/writing from media streams is finished. </p>

<p>Implemented in <a class="el" href="classAmSession.html#ae55fa9e53754fa552504ba8d9698efeb">AmSession</a>, and <a class="el" href="classAmB2BMedia.html#a8da0298b22c60e492ab59c95139a05af">AmB2BMedia</a>.</p>

</div>
</div>
<a class="anchor" id="a5d3ddc0cef7f238621fb95ca00c4a214"></a><!-- doxytag: member="AmMediaSession::readStreams" ref="a5d3ddc0cef7f238621fb95ca00c4a214" args="(unsigned long long ts, unsigned char *buffer)=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual int <a class="el" href="classAmMediaSession.html#a5d3ddc0cef7f238621fb95ca00c4a214">AmMediaSession::readStreams</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned long long&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read from all media streams.</p>
<p>To preserve current media processing scheme it is needed to read from all streams first and then write to them. This can be important for example in case of conferences where we need to have media from all streams ready for mixing them.</p>
<p>So the <a class="el" href="classAmMediaProcessorThread.html" title="Media processing thread.">AmMediaProcessorThread</a> first calls readStreams on all sessions and then writeStreams on all sessions.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>timestamp for which the processing is currently running</td></tr>
    <tr><td class="paramname">buffer</td><td>multi-purpose space given from outside (<a class="el" href="classAmMediaProcessorThread.html" title="Media processing thread.">AmMediaProcessorThread</a>)</td></tr>
  </table>
  </dd>
</dl>
<p>Buffer given as parametr is usable for anything, originally was intended for data read from one stream before putting to another stream.</p>
<p>The reason for having this buffer as parameter is that buffer size for audio processing is quite large (2K here) and thus allocating it on stack on some architectures may be problematic.</p>
<p>On other hand having the buffer dynamically allocated for each media session would significantly increase memory consumption per call.</p>
<p>So for now it seems to be the simplest way just to give the buffer as parameter from <a class="el" href="classAmMediaProcessorThread.html" title="Media processing thread.">AmMediaProcessorThread</a> and reuse it in all sessions handled by this thread (processing is done sequentially one session after another). </p>

<p>Implemented in <a class="el" href="classAmSession.html#a0be0d2ea796c8efc78fd203b1cff6b7c">AmSession</a>, <a class="el" href="classAmB2BMedia.html#a76a437d3a9a1998beb05da852b48dabe">AmB2BMedia</a>, <a class="el" href="classCallLeg.html#ae7e7901aeb61450a860f440779fc5832">CallLeg</a>, and <a class="el" href="classWebConferenceDialog.html#a68362ca579ab088aea9c2a94785abe10">WebConferenceDialog</a>.</p>

</div>
</div>
<a class="anchor" id="a7c7ab481a135ffd44d5d193607646513"></a><!-- doxytag: member="AmMediaSession::writeStreams" ref="a7c7ab481a135ffd44d5d193607646513" args="(unsigned long long ts, unsigned char *buffer)=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual int <a class="el" href="classAmMediaSession.html#a7c7ab481a135ffd44d5d193607646513">AmMediaSession::writeStreams</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned long long&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Write to all media streams.</p>
<p>For the meaning of parameters see description of <a class="el" href="classAmMediaSession.html#a5d3ddc0cef7f238621fb95ca00c4a214">readStreams()</a> method. </p>

<p>Implemented in <a class="el" href="classAmSession.html#a08a4ae5117109ed44c2b8f5d061e1755">AmSession</a>, <a class="el" href="classAmB2BMedia.html#ae0ebfc3de59cc154fd382eaa2c00eed1">AmB2BMedia</a>, and <a class="el" href="classCallLeg.html#a2f6e0b6a44eaaf04c21fc21783b68f9d">CallLeg</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="AmMediaProcessor_8h_source.html">AmMediaProcessor.h</a></li>
</ul>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
