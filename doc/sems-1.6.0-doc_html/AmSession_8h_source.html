<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SEMS: AmSession.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">SEMS
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_d469877a0d0803a4da6174ca6f049ecb.html">core</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">AmSession.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AmSession_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2002-2003 Fhg Fokus</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This file is part of SEMS, a free SIP media server.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * SEMS is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00008"></a>00008 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00009"></a>00009 <span class="comment"> * (at your option) any later version. This program is released under</span>
<a name="l00010"></a>00010 <span class="comment"> * the GPL with the additional exemption that compiling, linking,</span>
<a name="l00011"></a>00011 <span class="comment"> * and/or using OpenSSL is allowed.</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * For a license to use the SEMS software under conditions</span>
<a name="l00014"></a>00014 <span class="comment"> * other than those described here, or to purchase support for this</span>
<a name="l00015"></a>00015 <span class="comment"> * software, please contact iptel.org by e-mail at the following addresses:</span>
<a name="l00016"></a>00016 <span class="comment"> *    info@iptel.org</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * SEMS is distributed in the hope that it will be useful,</span>
<a name="l00019"></a>00019 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00020"></a>00020 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00021"></a>00021 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * You should have received a copy of the GNU General Public License </span>
<a name="l00024"></a>00024 <span class="comment"> * along with this program; if not, write to the Free Software </span>
<a name="l00025"></a>00025 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#ifndef _AmSession_h_</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#define _AmSession_h_</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="AmRtpStream_8h.html">AmRtpStream.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="AmThread_8h.html">AmThread.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="AmEventQueue_8h.html">AmEventQueue.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="AmRtpAudio_8h.html">AmRtpAudio.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="AmDtmfDetector_8h.html">AmDtmfDetector.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;AmSipMsg.h&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;AmSipHeaders.h&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="AmSipDialog_8h.html">AmSipDialog.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="AmSipEvent_8h.html">AmSipEvent.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="AmApi_8h.html">AmApi.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;AmSessionEventHandler.h&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="AmMediaProcessor_8h.html">AmMediaProcessor.h</a>&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;AmZRTP.h&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;queue&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00050"></a>00050 <span class="keyword">using</span> std::string;
<a name="l00051"></a>00051 <span class="keyword">using</span> std::vector;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="keyword">class </span><a class="code" href="classAmSessionFactory.html" title="Interface for plugins to create sessions.">AmSessionFactory</a>;
<a name="l00054"></a>00054 <span class="keyword">class </span><a class="code" href="classAmDtmfEvent.html" title="Base class for DTMF events.">AmDtmfEvent</a>;
<a name="l00055"></a>00055 
<a name="l00058"></a>00058 <span class="comment">/* definition imported from Ser parser/msg_parser.h */</span>
<a name="l00059"></a>00059 <span class="preprocessor">#define FL_FORCE_ACTIVE 2</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00061"></a>00061 
<a name="l00067"></a><a class="code" href="classAmSession.html">00067</a> <span class="keyword">class </span><a class="code" href="classAmSession.html" title="Implements the default behavior of one session.">AmSession</a> : 
<a name="l00068"></a>00068   <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="classAmObject.html">AmObject</a>,
<a name="l00069"></a>00069 <span class="preprocessor">#ifndef SESSION_THREADPOOL</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>  <span class="keyword">public</span> <a class="code" href="classAmThread.html" title="C++ Wrapper class for pthread.">AmThread</a>,
<a name="l00071"></a>00071 <span class="preprocessor">#endif</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>  <span class="keyword">public</span> <a class="code" href="classAmEventQueue.html" title="Asynchronous event queue implementation.">AmEventQueue</a>, 
<a name="l00073"></a>00073   <span class="keyword">public</span> <a class="code" href="classAmEventHandler.html" title="event handler interface">AmEventHandler</a>,
<a name="l00074"></a>00074   <span class="keyword">public</span> <a class="code" href="classAmSipDialogEventHandler.html" title="base class for SIP request/reply event handler">AmSipDialogEventHandler</a>,
<a name="l00075"></a>00075   <span class="keyword">public</span> <a class="code" href="classAmMediaSession.html">AmMediaSession</a>,
<a name="l00076"></a>00076   <span class="keyword">public</span> <a class="code" href="classAmDtmfSink.html" title="DTMF sink class.">AmDtmfSink</a>
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078   <a class="code" href="classAmMutex.html" title="C++ Wrapper class for pthread mutex.">AmMutex</a>      audio_mut;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="keyword">protected</span>:
<a name="l00081"></a>00081   vector&lt;SdpPayload *&gt;  m_payloads;
<a name="l00082"></a>00082   <span class="comment">//bool         negotiate_onreply;</span>
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classAmRtpAudio.html" title="binds together a AmRtpStream and an AmAudio for a session">AmRtpAudio</a>;
<a name="l00085"></a>00085 
<a name="l00087"></a>00087   <span class="comment">//virtual AmAudioRtpFormat* getNewRtpFormat();</span>
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="keyword">private</span>:
<a name="l00090"></a>00090   <a class="code" href="classAmDtmfDetector.html" title="DTMF detector class.">AmDtmfDetector</a>   m_dtmfDetector;
<a name="l00091"></a>00091   <a class="code" href="classAmDtmfEventQueue.html" title="sink for audio to be processed by the inband DTMF detector">AmDtmfEventQueue</a> m_dtmfEventQueue;
<a name="l00092"></a>00092   <span class="keywordtype">bool</span> m_dtmfDetectionEnabled;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094   <span class="keyword">enum</span> ProcessingStatus { 
<a name="l00095"></a>00095     SESSION_PROCESSING_EVENTS = 0,
<a name="l00096"></a>00096     SESSION_WAITING_DISCONNECTED,
<a name="l00097"></a>00097     SESSION_ENDED_DISCONNECTED
<a name="l00098"></a>00098   };
<a name="l00099"></a>00099   ProcessingStatus processing_status;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="preprocessor">#ifndef SESSION_THREADPOOL</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00103"></a>00103   <span class="keywordtype">void</span> run();
<a name="l00104"></a>00104   <span class="keywordtype">void</span> on_stop();
<a name="l00105"></a>00105 <span class="preprocessor">#else</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span><span class="keyword">public</span>:
<a name="l00107"></a>00107   <span class="keywordtype">void</span> <a class="code" href="classAmThread.html#a9f8c7d13289c933ed97b76988ad24bf1">start</a>();
<a name="l00108"></a>00108   <span class="keywordtype">bool</span> <a class="code" href="classAmThread.html#a98df333130b7daae511da23220e84b62">is_stopped</a>();
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="keyword">private</span>:
<a name="l00111"></a>00111   <span class="keywordtype">void</span> <a class="code" href="classAmThread.html#a3d707524014e41de151d8fe5272664e9">stop</a>();
<a name="l00112"></a>00112   <span class="keywordtype">void</span>* _pid;
<a name="l00113"></a>00113 <span class="preprocessor">#endif</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>
<a name="l00115"></a>00115   <span class="keyword">static</span> <span class="keywordtype">void</span> session_started();
<a name="l00116"></a>00116   <span class="keyword">static</span> <span class="keywordtype">void</span> session_stopped();
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> session_num;
<a name="l00119"></a>00119   <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_session_num;
<a name="l00120"></a>00120   <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> avg_session_num;
<a name="l00121"></a>00121   <span class="keyword">static</span> <a class="code" href="classAmMutex.html" title="C++ Wrapper class for pthread mutex.">AmMutex</a> session_num_mut;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classAmMediaProcessor.html" title="Media processing thread manager.">AmMediaProcessor</a>;
<a name="l00124"></a>00124   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classAmMediaProcessorThread.html" title="Media processing thread.">AmMediaProcessorThread</a>;
<a name="l00125"></a>00125   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classAmSessionContainer.html" title="Centralized session container.">AmSessionContainer</a>;
<a name="l00126"></a>00126   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classAmSessionFactory.html" title="Interface for plugins to create sessions.">AmSessionFactory</a>;
<a name="l00127"></a>00127   <span class="keyword">friend</span> <span class="keyword">class </span>AmSessionProcessorThread;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129   auto_ptr&lt;AmRtpAudio&gt; _rtp_str;
<a name="l00130"></a>00130 
<a name="l00132"></a>00132   map&lt;string,string&gt; app_params;
<a name="l00133"></a>00133 
<a name="l00135"></a>00135   <span class="keywordtype">void</span> setAppParams(<span class="keyword">const</span> <a class="code" href="classAmSipRequest.html" title="represents a SIP request">AmSipRequest</a>&amp; req);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="keyword">protected</span>:
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   <a class="code" href="classAmCondition.html">AmCondition&lt;bool&gt;</a> sess_stopped;
<a name="l00140"></a>00140 
<a name="l00143"></a><a class="code" href="classAmSession.html#a6387c4e60b099ceeb35e4103796014a1">00143</a>   <span class="keywordtype">string</span> <a class="code" href="classAmSession.html#a6387c4e60b099ceeb35e4103796014a1">callgroup</a>;
<a name="l00144"></a>00144 
<a name="l00146"></a><a class="code" href="classAmSession.html#af32e69fe33fc79e68d423af4e6e7b55f">00146</a>   <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#af32e69fe33fc79e68d423af4e6e7b55f">accept_early_session</a>;
<a name="l00147"></a>00147 
<a name="l00149"></a><a class="code" href="classAmSession.html#ad9f5712600601aa7c9e07ee9998a39a3">00149</a>   <span class="keywordtype">int</span> <a class="code" href="classAmSession.html#ad9f5712600601aa7c9e07ee9998a39a3">rtp_interface</a>;
<a name="l00150"></a>00150 
<a name="l00152"></a><a class="code" href="classAmSession.html#aa261b424e65666e127aa85c3ff915a1b">00152</a>   vector&lt;AmSessionEventHandler*&gt; <a class="code" href="classAmSession.html#aa261b424e65666e127aa85c3ff915a1b">ev_handlers</a>;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154   <a class="code" href="classAmAudio.html" title="base for classes that input or output audio.">AmAudio</a> *input, *output;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156   <span class="keyword">virtual</span> <a class="code" href="classAmSipDialog.html" title="implements the dialog state machine">AmSipDialog</a>* createSipDialog();
<a name="l00157"></a>00157 
<a name="l00160"></a>00160   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#ac436cd677c07b698506080a0b825e7cf">processEventsCatchExceptions</a>();
<a name="l00161"></a>00161 
<a name="l00163"></a>00163   <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#a03ad31ea20a4c263d3fed0ed7c5dd8e0">startup</a>();
<a name="l00164"></a>00164 
<a name="l00166"></a>00166   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#af46a64f82f28f6b0d415954f564beb15">processingCycle</a>();
<a name="l00167"></a>00167 
<a name="l00169"></a>00169   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a6cf5cd4a4260bb052610c6b408342643">finalize</a>();
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="keyword">public</span>:
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="keyword">enum</span> SessionRefreshMethod {
<a name="l00174"></a>00174     REFRESH_REINVITE = 0,      <span class="comment">// use reinvite</span>
<a name="l00175"></a>00175     REFRESH_UPDATE,            <span class="comment">// use update</span>
<a name="l00176"></a>00176     REFRESH_UPDATE_FB_REINV    <span class="comment">// use update or fallback to reinvite</span>
<a name="l00177"></a>00177   };
<a name="l00179"></a><a class="code" href="classAmSession.html#ac0cdfc288b864de224b202be990c8987">00179</a>   SessionRefreshMethod <a class="code" href="classAmSession.html#ac0cdfc288b864de224b202be990c8987">refresh_method</a>;
<a name="l00180"></a>00180 
<a name="l00182"></a>00182   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a264242a5033c06b9629cc8b9fb64a9d9">updateRefreshMethod</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; headers);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <a class="code" href="classAmRtpAudio.html" title="binds together a AmRtpStream and an AmAudio for a session">AmRtpAudio</a>* RTPStream();
<a name="l00185"></a>00185   <span class="keywordtype">bool</span> hasRtpStream() { <span class="keywordflow">return</span> _rtp_str.get() != NULL; }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 <span class="preprocessor">#ifdef WITH_ZRTP</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>  AmZRTPSessionState zrtp_session_state;
<a name="l00189"></a>00189 
<a name="l00191"></a>00191   <span class="keywordtype">bool</span> enable_zrtp;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="preprocessor">#endif</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>
<a name="l00195"></a>00195   <a class="code" href="classAmSipDialog.html" title="implements the dialog state machine">AmSipDialog</a>* dlg;
<a name="l00196"></a>00196 
<a name="l00202"></a><a class="code" href="structAmSession_1_1Exception.html">00202</a>   <span class="keyword">struct </span><a class="code" href="structAmSession_1_1Exception.html" title="Exception occured in a Session.">Exception</a> {
<a name="l00203"></a>00203     <span class="keywordtype">int</span> code;
<a name="l00204"></a>00204     <span class="keywordtype">string</span> reason;
<a name="l00205"></a>00205     <span class="keywordtype">string</span> hdrs;
<a name="l00206"></a>00206     <a class="code" href="structAmSession_1_1Exception.html" title="Exception occured in a Session.">Exception</a>(<span class="keywordtype">int</span> c, <span class="keywordtype">string</span> r, <span class="keywordtype">string</span> h=<span class="stringliteral">&quot;&quot;</span>) : code(c), reason(r), hdrs(h) {}
<a name="l00207"></a>00207   };
<a name="l00208"></a>00208 
<a name="l00212"></a>00212   <a class="code" href="classAmSession.html#a7cc9442789c14d48af8344d9875e39ad">AmSession</a>(<a class="code" href="classAmSipDialog.html" title="implements the dialog state machine">AmSipDialog</a>* dlg=NULL);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214   <span class="keyword">virtual</span> ~<a class="code" href="classAmSession.html" title="Implements the default behavior of one session.">AmSession</a>();
<a name="l00215"></a>00215 
<a name="l00219"></a>00219   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a667b1f428feb33189aa569ca882ed757">process</a>(<a class="code" href="structAmEvent.html" title="base event class">AmEvent</a>*);
<a name="l00220"></a>00220 
<a name="l00227"></a>00227   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a9a2f303acd6a35a2043327b104e22714">addHandler</a>(<a class="code" href="classAmSessionEventHandler.html" title="Interface for SIP signaling plugins that change requests or replies using hooks (ex: session timer)...">AmSessionEventHandler</a>*);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   <span class="comment">/* ----         media processing                    ---- */</span>
<a name="l00230"></a>00230 
<a name="l00232"></a>00232   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a46a85bb8417b1eb177a89ae429714d5b">startMediaProcessing</a>();
<a name="l00233"></a>00233 
<a name="l00235"></a>00235   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#ab80c377e4df759b7cb3a85c00d58b405">stopMediaProcessing</a>();
<a name="l00236"></a>00236 
<a name="l00244"></a>00244   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#aafbd8c52ed6bc4992b9a25df14134960">setCallgroup</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; cg);
<a name="l00245"></a>00245 
<a name="l00247"></a>00247   <span class="keywordtype">string</span> <a class="code" href="classAmSession.html#a11c6d353ebaeef61fa9e0071a734c843">getCallgroup</a>();
<a name="l00248"></a>00248 
<a name="l00255"></a>00255   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a2aae5f54ae5892a7ad31be48715a9e49">changeCallgroup</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; cg);
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <span class="comment">/* ----         audio input and output        ---- */</span>
<a name="l00258"></a>00258 
<a name="l00263"></a>00263   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a11bcf7bc3296377cc23aad9aa3716a44">lockAudio</a>();
<a name="l00264"></a>00264 
<a name="l00269"></a>00269   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a7d61d1f81277c827d84f20e5d12d8756">unlockAudio</a>();
<a name="l00270"></a>00270 
<a name="l00275"></a><a class="code" href="classAmSession.html#a81c61f0ace0e4f8f39a34cd107a2f1a9">00275</a>   <a class="code" href="classAmAudio.html" title="base for classes that input or output audio.">AmAudio</a>* <a class="code" href="classAmSession.html#a81c61f0ace0e4f8f39a34cd107a2f1a9">getInput</a>() { <span class="keywordflow">return</span> input; }
<a name="l00280"></a><a class="code" href="classAmSession.html#aba7b8d7385f02edd59ee43c9f63a43cf">00280</a>   <a class="code" href="classAmAudio.html" title="base for classes that input or output audio.">AmAudio</a>* <a class="code" href="classAmSession.html#aba7b8d7385f02edd59ee43c9f63a43cf">getOutput</a>() { <span class="keywordflow">return</span> output; }
<a name="l00281"></a>00281 
<a name="l00286"></a>00286   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a6bf04879a94c578239d1602bd7b9f62a">setInput</a>(<a class="code" href="classAmAudio.html" title="base for classes that input or output audio.">AmAudio</a>* in);
<a name="l00287"></a>00287   <span class="keywordtype">void</span> setOutput(<a class="code" href="classAmAudio.html" title="base for classes that input or output audio.">AmAudio</a>* out);
<a name="l00288"></a>00288   <span class="keywordtype">void</span> setInOut(<a class="code" href="classAmAudio.html" title="base for classes that input or output audio.">AmAudio</a>* in, <a class="code" href="classAmAudio.html" title="base for classes that input or output audio.">AmAudio</a>* out);
<a name="l00289"></a>00289 
<a name="l00291"></a>00291   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#a07d01cc105441975730ba97c7160a390">isAudioSet</a>();
<a name="l00292"></a>00292 
<a name="l00296"></a>00296   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#aad988b8fbd9298111d673fed35270b4c">clearAudio</a>();
<a name="l00297"></a>00297 
<a name="l00299"></a><a class="code" href="classAmSession.html#a2f11b926380f09cd9969132920f0f0c6">00299</a>   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a2f11b926380f09cd9969132920f0f0c6">setMute</a>(<span class="keywordtype">bool</span> mute) { RTPStream()-&gt;<a class="code" href="classAmRtpStream.html#a2c67fe4fe748563338e7912933f99bb4">mute</a> = mute; }
<a name="l00300"></a>00300 
<a name="l00302"></a><a class="code" href="classAmSession.html#aa4c66080bb66423b3c6fd5901061708c">00302</a>   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#aa4c66080bb66423b3c6fd5901061708c">setReceiving</a>(<span class="keywordtype">bool</span> receive) { RTPStream()-&gt;<a class="code" href="classAmRtpStream.html#a25619f179705fe6dc832cbaf8ed82f34">setReceiving</a>(receive); }
<a name="l00303"></a>00303 
<a name="l00305"></a><a class="code" href="classAmSession.html#a4072e9638d3b2a7a094bcc12d3efb04e">00305</a>   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a4072e9638d3b2a7a094bcc12d3efb04e">setForceDtmfReceiving</a>(<span class="keywordtype">bool</span> receive) { RTPStream()-&gt;<a class="code" href="classAmRtpStream.html#a56a7f15b3abded9685fd83fd59de5704">force_receive_dtmf</a> = receive; }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <span class="comment">/* ----         SIP dialog attributes                  ---- */</span>
<a name="l00308"></a>00308 
<a name="l00310"></a>00310   <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; <a class="code" href="classAmSession.html#a4bfb1b0a9dfa9999536aa0cdb1bd8f0b">getCallID</a>() <span class="keyword">const</span>;
<a name="l00311"></a>00311 
<a name="l00313"></a>00313   <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; <a class="code" href="classAmSession.html#a9274cf4c177a8427cf210996b7cb9c89">getRemoteTag</a>()<span class="keyword">const</span> ;
<a name="l00314"></a>00314 
<a name="l00316"></a>00316   <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; <a class="code" href="classAmSession.html#a2bc9fd877d1880f80bc636620359c202">getLocalTag</a>() <span class="keyword">const</span>;
<a name="l00317"></a>00317 
<a name="l00319"></a>00319   <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; <a class="code" href="classAmSession.html#a0b58c4a3f67e4848988e362f783bca20">getFirstBranch</a>() <span class="keyword">const</span>;
<a name="l00320"></a>00320 
<a name="l00322"></a>00322   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a61a53af2bd2401babdb3f6effde5fbeb">setLocalTag</a>();
<a name="l00323"></a>00323 
<a name="l00325"></a>00325   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a61a53af2bd2401babdb3f6effde5fbeb">setLocalTag</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; tag);
<a name="l00326"></a>00326 
<a name="l00328"></a>00328   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#aada78d95c9057a33e9f9ca7ce8caaeca">setUri</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; uri);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330   <span class="comment">/* ----         RTP stream attributes                  ---- */</span>
<a name="l00331"></a>00331 
<a name="l00333"></a>00333   <span class="keyword">const</span> vector&lt;SdpPayload*&gt;&amp; <a class="code" href="classAmSession.html#a97af886a4b0d591611fa8b0da8498e17">getPayloads</a>();
<a name="l00334"></a>00334 
<a name="l00336"></a>00336   <span class="keywordtype">int</span> <a class="code" href="classAmSession.html#a43db2ea3bd3d2bfbb6b5a7e29d4ba550">getRPort</a>();
<a name="l00337"></a>00337 
<a name="l00338"></a>00338   <span class="comment">/* ----         Call control                         ---- */</span>
<a name="l00339"></a>00339 
<a name="l00341"></a>00341   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#af932e3f0557a099d4a99fc764c8d6aa2">refresh</a>(<span class="keywordtype">int</span> flags = 0);
<a name="l00342"></a>00342 
<a name="l00344"></a>00344   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classAmSession.html#a8626a0173593b0bf95aecb843217a8f6">sendUpdate</a>(<span class="keyword">const</span> <a class="code" href="classAmMimeBody.html">AmMimeBody</a>* body, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;hdrs);
<a name="l00345"></a>00345 
<a name="l00347"></a>00347   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classAmSession.html#ae63100a59b4eab61c191b88152ad49f5">sendReinvite</a>(<span class="keywordtype">bool</span> updateSDP = <span class="keyword">true</span>, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; headers = <span class="stringliteral">&quot;&quot;</span>,
<a name="l00348"></a>00348                            <span class="keywordtype">int</span> flags = 0);
<a name="l00349"></a>00349 
<a name="l00351"></a>00351   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classAmSession.html#a108050ddcd0ca53ec065e4c3c37768cc">sendInvite</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; headers = <span class="stringliteral">&quot;&quot;</span>);
<a name="l00352"></a>00352 
<a name="l00354"></a>00354   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a867790bee968806761879cb9373be561">setOnHold</a>(<span class="keywordtype">bool</span> hold);
<a name="l00355"></a>00355 
<a name="l00359"></a><a class="code" href="classAmSession.html#a936c3640b8b3b0d770f434f205c95880">00359</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a936c3640b8b3b0d770f434f205c95880">updateUACTransCSeq</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> old_cseq, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_cseq) { }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361   <span class="comment">/* ----         Householding                              ---- */</span>
<a name="l00362"></a>00362 
<a name="l00366"></a>00366   <span class="keywordtype">string</span> <a class="code" href="classAmSession.html#a455cea0e0e90b2bb03e9a8f82b34b3f9">getAppParam</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; param_name) <span class="keyword">const</span>;
<a name="l00367"></a>00367 
<a name="l00374"></a>00374   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a3bb9f628ebf3836ecf7baac092e4b502">destroy</a>();
<a name="l00375"></a>00375 
<a name="l00383"></a>00383   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a97433a220cc63b64b29979372868727b">setStopped</a>(<span class="keywordtype">bool</span> wakeup = <span class="keyword">false</span>);
<a name="l00384"></a>00384 
<a name="l00388"></a><a class="code" href="classAmSession.html#a1f22e03861b550071b50a5a076c18d43">00388</a>   <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#a1f22e03861b550071b50a5a076c18d43">getStopped</a>() { <span class="keywordflow">return</span> sess_stopped.get(); }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390   <span class="comment">/* ----         Statistics                    ---- */</span>
<a name="l00394"></a>00394   <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classAmSession.html#a073095d2e8dd408bd80892d0eb69f642">getSessionNum</a>();
<a name="l00398"></a>00398   <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classAmSession.html#aa7a5ae82399b8bcfb06f05a960cd51b5">getMaxSessionNum</a>();
<a name="l00402"></a>00402   <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classAmSession.html#a3c9b9d6a0f1ce00137afe48b6e50b23d">getAvgSessionNum</a>();
<a name="l00403"></a>00403 
<a name="l00404"></a>00404   <span class="comment">/* ----         DTMF                          ---- */</span>
<a name="l00408"></a>00408   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a4e9a1acc356b031a8d78d944428399d6">postDtmfEvent</a>(<a class="code" href="classAmDtmfEvent.html" title="Base class for DTMF events.">AmDtmfEvent</a> *);
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <span class="keywordtype">void</span> setInbandDetector(Dtmf::InbandDetectorType t);
<a name="l00411"></a>00411   <span class="keywordtype">bool</span> isDtmfDetectionEnabled() { <span class="keywordflow">return</span> m_dtmfDetectionEnabled; }
<a name="l00412"></a>00412   <span class="keywordtype">void</span> setDtmfDetectionEnabled(<span class="keywordtype">bool</span> e) { m_dtmfDetectionEnabled = e; }
<a name="l00413"></a>00413   <span class="keywordtype">void</span> putDtmfAudio(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> size, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> system_ts);
<a name="l00414"></a>00414 
<a name="l00420"></a>00420   <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a30740823fb51d4707b5818a42912692e">sendDtmf</a>(<span class="keywordtype">int</span> event, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> duration_ms);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422   <span class="comment">/* ---- general purpose application level timers ------------ */</span>
<a name="l00423"></a>00423 
<a name="l00427"></a>00427   <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#aa8203b2e568afd2349739c5d6a11c12e">timersSupported</a>();
<a name="l00428"></a>00428 
<a name="l00435"></a>00435   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#af51362cbc11e8de8908fe4f59aa0dc18">setTimer</a>(<span class="keywordtype">int</span> timer_id, <span class="keywordtype">double</span> timeout);
<a name="l00436"></a>00436 
<a name="l00442"></a>00442   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#a07f87e9cfdf459aad1766b44b413ee06">removeTimer</a>(<span class="keywordtype">int</span> timer_id);
<a name="l00443"></a>00443 
<a name="l00450"></a>00450   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#ac62e76ad7d487131748f4cbb23fcfc68">removeTimers</a>();
<a name="l00451"></a>00451 
<a name="l00452"></a>00452   <span class="comment">/* ---------- event handlers ------------------------- */</span>
<a name="l00453"></a>00453 
<a name="l00455"></a>00455   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#ad64183ceeb14cef31286749f3c913eea">onDtmf</a>(<span class="keywordtype">int</span> event, <span class="keywordtype">int</span> duration);
<a name="l00456"></a>00456 
<a name="l00460"></a><a class="code" href="classAmSession.html#a8d47b21842cc702b4cbbf91f8cae04fb">00460</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a8d47b21842cc702b4cbbf91f8cae04fb">onStart</a>() {}
<a name="l00461"></a>00461 
<a name="l00466"></a><a class="code" href="classAmSession.html#a69451ba31a8c764c2dd050e3fa09a3c0">00466</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a69451ba31a8c764c2dd050e3fa09a3c0">onStop</a>() {}
<a name="l00467"></a>00467 
<a name="l00472"></a>00472   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a9cb573a2726f7eb4479563006676b2f7">onInvite</a>(<span class="keyword">const</span> <a class="code" href="classAmSipRequest.html" title="represents a SIP request">AmSipRequest</a>&amp; req);
<a name="l00473"></a>00473 
<a name="l00478"></a><a class="code" href="classAmSession.html#a21ab71aadd5b65d64adde3a424316875">00478</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a21ab71aadd5b65d64adde3a424316875">onOutgoingInvite</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; headers) { }
<a name="l00479"></a>00479 
<a name="l00492"></a>00492   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#ae75a344333b5b1cd0c0ce6de59dca99a">onCancel</a>(<span class="keyword">const</span> <a class="code" href="classAmSipRequest.html" title="represents a SIP request">AmSipRequest</a>&amp; req);
<a name="l00493"></a>00493 
<a name="l00498"></a><a class="code" href="classAmSession.html#aaa682006dbe664cca9648a0a49aa01e3">00498</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#aaa682006dbe664cca9648a0a49aa01e3">onRinging</a>(<span class="keyword">const</span> <a class="code" href="classAmSipReply.html" title="represents a SIP reply">AmSipReply</a>&amp; reply) {}
<a name="l00499"></a>00499 
<a name="l00503"></a>00503   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#ad97c6fd0d380ebf7b49201b721852fd9">onBye</a>(<span class="keyword">const</span> <a class="code" href="classAmSipRequest.html" title="represents a SIP request">AmSipRequest</a>&amp; req);
<a name="l00504"></a>00504 
<a name="l00506"></a>00506   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a2338de68661dbb05556c99227c20842f">onRemoteDisappeared</a>(<span class="keyword">const</span> <a class="code" href="classAmSipReply.html" title="represents a SIP reply">AmSipReply</a>&amp;);
<a name="l00507"></a>00507 
<a name="l00509"></a>00509   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#ab12b1a5e8d2c27f137ff3836e0ff21b2">onSipRequest</a>(<span class="keyword">const</span> <a class="code" href="classAmSipRequest.html" title="represents a SIP request">AmSipRequest</a>&amp; req);
<a name="l00510"></a>00510 
<a name="l00512"></a>00512   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a1ca5f6b9fda2ee17c2d7f453b96249db">onSipReply</a>(<span class="keyword">const</span> <a class="code" href="classAmSipRequest.html" title="represents a SIP request">AmSipRequest</a>&amp; req, <span class="keyword">const</span> <a class="code" href="classAmSipReply.html" title="represents a SIP reply">AmSipReply</a>&amp; reply, 
<a name="l00513"></a>00513                           AmBasicSipDialog::Status old_dlg_status);
<a name="l00514"></a>00514 
<a name="l00516"></a>00516   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a627af1af54790c4500a80f347e89f3a5">onInvite2xx</a>(<span class="keyword">const</span> <a class="code" href="classAmSipReply.html" title="represents a SIP reply">AmSipReply</a>&amp; reply);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a0fcd281df78c5120e0bb658cfac5ec56">onInvite1xxRel</a>(<span class="keyword">const</span> <a class="code" href="classAmSipReply.html" title="represents a SIP reply">AmSipReply</a> &amp;);
<a name="l00519"></a>00519 
<a name="l00521"></a>00521   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#ae671e7ffc0111565403fff2647ca6573">onPrack2xx</a>(<span class="keyword">const</span> <a class="code" href="classAmSipReply.html" title="represents a SIP reply">AmSipReply</a> &amp;);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#aa98b899b1b335b229a0e5c1a057a5ad0">onFailure</a>();
<a name="l00524"></a>00524   
<a name="l00525"></a>00525   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a4e699821753df4a66e1f476af7013844">onNoAck</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cseq);
<a name="l00526"></a>00526   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a4bb8b400b431d94b60f0c6d0273f670a">onNoPrack</a>(<span class="keyword">const</span> <a class="code" href="classAmSipRequest.html" title="represents a SIP request">AmSipRequest</a> &amp;req, <span class="keyword">const</span> <a class="code" href="classAmSipReply.html" title="represents a SIP reply">AmSipReply</a> &amp;rpl);
<a name="l00527"></a>00527 
<a name="l00531"></a>00531   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#ac2ad9e710c949b808d15108612664c93">onAudioEvent</a>(<a class="code" href="classAmAudioEvent.html" title="Audio Event.">AmAudioEvent</a>* audio_ev);
<a name="l00532"></a>00532 
<a name="l00536"></a>00536   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#af7843e02b2568fed9484fbdc4b629db4">onSystemEvent</a>(<a class="code" href="structAmSystemEvent.html" title="named event for system events (e.g. server stopped)">AmSystemEvent</a>* ev);
<a name="l00537"></a>00537   
<a name="l00538"></a>00538 <span class="preprocessor">#ifdef WITH_ZRTP</span>
<a name="l00539"></a>00539 <span class="preprocessor"></span>
<a name="l00542"></a>00542   <span class="keyword">virtual</span> <span class="keywordtype">void</span> onZRTPProtocolEvent(zrtp_protocol_event_t event, zrtp_stream_t *stream_ctx);
<a name="l00543"></a>00543   <span class="keyword">virtual</span> <span class="keywordtype">void</span> onZRTPSecurityEvent(zrtp_security_event_t event, zrtp_stream_t *stream_ctx);
<a name="l00544"></a>00544 <span class="preprocessor">#endif</span>
<a name="l00545"></a>00545 <span class="preprocessor"></span>
<a name="l00547"></a>00547   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#adb5907445d0a4c5ddc95fbd1ffcacdc5">onRtpTimeout</a>();
<a name="l00548"></a>00548 
<a name="l00551"></a>00551   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#ad17acd306679a1ecd0e0182bd3848151">onSessionTimeout</a>();
<a name="l00552"></a>00552 
<a name="l00553"></a>00553   <span class="comment">/* Called by AmSipDialog when a request is sent */</span>
<a name="l00554"></a>00554   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#ababe82a677a777a6cd363323951c9af5">onSendRequest</a>(<a class="code" href="classAmSipRequest.html" title="represents a SIP request">AmSipRequest</a>&amp; req, <span class="keywordtype">int</span>&amp; flags);
<a name="l00555"></a>00555 
<a name="l00557"></a>00557   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a5bd32f1fd1e690ce360a4beaca4c7801">onSendReply</a>(<span class="keyword">const</span> <a class="code" href="classAmSipRequest.html" title="represents a SIP request">AmSipRequest</a>&amp; req, <a class="code" href="classAmSipReply.html" title="represents a SIP reply">AmSipReply</a>&amp; reply, <span class="keywordtype">int</span>&amp; flags);
<a name="l00558"></a>00558 
<a name="l00560"></a>00560   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#a0b5e3ec8a1953a613460754f0e70833f">getSdpOffer</a>(<a class="code" href="classAmSdp.html" title="The SDP parser class.">AmSdp</a>&amp; offer);
<a name="l00561"></a>00561 
<a name="l00563"></a>00563   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#ad63549078e21fc41dfc0dc471006d803">getSdpAnswer</a>(<span class="keyword">const</span> <a class="code" href="classAmSdp.html" title="The SDP parser class.">AmSdp</a>&amp; offer, <a class="code" href="classAmSdp.html" title="The SDP parser class.">AmSdp</a>&amp; answer);
<a name="l00564"></a>00564 
<a name="l00566"></a>00566   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classAmSession.html#ae8104f2197534e0e0dc2df72ab6ebf7a">onSdpCompleted</a>(<span class="keyword">const</span> <a class="code" href="classAmSdp.html" title="The SDP parser class.">AmSdp</a>&amp; offer, <span class="keyword">const</span> <a class="code" href="classAmSdp.html" title="The SDP parser class.">AmSdp</a>&amp; answer);
<a name="l00567"></a>00567 
<a name="l00569"></a>00569   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#accee3764f503775e5be6ebaa0efeef52">onEarlySessionStart</a>();
<a name="l00570"></a>00570 
<a name="l00572"></a>00572   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#ade7ae41dfde35e34614d93c21b0fd4ba">onSessionStart</a>();
<a name="l00573"></a>00573 
<a name="l00578"></a><a class="code" href="classAmSession.html#a805f839832877bef6bfb6db8bddeda91">00578</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#a805f839832877bef6bfb6db8bddeda91">onBeforeDestroy</a>() { }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580   <span class="comment">// The IP address to put as c= in SDP bodies</span>
<a name="l00581"></a>00581   <span class="keywordtype">string</span> advertisedIP(<span class="keywordtype">int</span> addrType = AT_NONE);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583   <span class="comment">// IP address used to bind the RTP socket</span>
<a name="l00584"></a>00584   <span class="keywordtype">string</span> localMediaIP(<span class="keywordtype">int</span> addrType = AT_NONE);
<a name="l00585"></a>00585 
<a name="l00587"></a>00587   <span class="keywordtype">string</span> <a class="code" href="classAmSession.html#ae63ef2038397ac8b46ded3f70b179a45">sid4dbg</a>();
<a name="l00588"></a>00588 
<a name="l00592"></a>00592   <span class="keyword">static</span> <span class="keywordtype">string</span> <a class="code" href="classAmSession.html#a88745a05b9f8a75b3c87a333fb9235ea">getNewId</a>();
<a name="l00593"></a>00593 
<a name="l00594"></a>00594   <span class="comment">/* ----------------- media processing interface ------------------- */</span>
<a name="l00595"></a>00595 
<a name="l00596"></a>00596 <span class="keyword">public</span>: 
<a name="l00597"></a>00597   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classAmSession.html#a0be0d2ea796c8efc78fd203b1cff6b7c">readStreams</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> ts, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer);
<a name="l00598"></a>00598   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classAmSession.html#a08a4ae5117109ed44c2b8f5d061e1755">writeStreams</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> ts, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer);
<a name="l00599"></a><a class="code" href="classAmSession.html#aeed92b3df398866ac9f62adb47e7af59">00599</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#aeed92b3df398866ac9f62adb47e7af59">clearRTPTimeout</a>() { RTPStream()-&gt;<a class="code" href="classAmRtpStream.html#a2f454adfe3554df831c90d836ea2959e">clearRTPTimeout</a>(); }
<a name="l00600"></a>00600   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAmSession.html#ae55fa9e53754fa552504ba8d9698efeb">processDtmfEvents</a>();
<a name="l00601"></a>00601 
<a name="l00607"></a><a class="code" href="classAmSession.html#a332916332462080d8c3857644cd90798">00607</a>   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classAmSession.html#a332916332462080d8c3857644cd90798">onBeforeRTPRelay</a>(<a class="code" href="classAmRtpPacket.html" title="RTP packet implementation.">AmRtpPacket</a>* p, sockaddr_storage* remote_addr)
<a name="l00608"></a>00608   { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610   <span class="keyword">virtual</span> <span class="keywordtype">void</span> onAfterRTPRelay(<a class="code" href="classAmRtpPacket.html" title="RTP packet implementation.">AmRtpPacket</a>* p, sockaddr_storage* remote_addr) {}
<a name="l00611"></a>00611 
<a name="l00612"></a>00612   <span class="keywordtype">int</span> getRtpInterface();
<a name="l00613"></a>00613   <span class="keywordtype">void</span> setRtpInterface(<span class="keywordtype">int</span> _rtp_interface);
<a name="l00614"></a>00614 };
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 <span class="keyword">inline</span> <a class="code" href="classAmRtpAudio.html" title="binds together a AmRtpStream and an AmAudio for a session">AmRtpAudio</a>* AmSession::RTPStream() {
<a name="l00617"></a>00617   <span class="keywordflow">if</span> (NULL == _rtp_str.get()) {
<a name="l00618"></a>00618     DBG(<span class="stringliteral">&quot;creating RTP stream instance for session [%p]\n&quot;</span>, 
<a name="l00619"></a>00619         <span class="keyword">this</span>);
<a name="l00620"></a>00620     _rtp_str.reset(<span class="keyword">new</span> <a class="code" href="classAmRtpAudio.html" title="binds together a AmRtpStream and an AmAudio for a session">AmRtpAudio</a>(<span class="keyword">this</span>,<a class="code" href="classAmSession.html#ad9f5712600601aa7c9e07ee9998a39a3">rtp_interface</a>));
<a name="l00621"></a>00621   }
<a name="l00622"></a>00622   <span class="keywordflow">return</span> _rtp_str.get();
<a name="l00623"></a>00623 }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 <span class="preprocessor">#endif</span>
<a name="l00627"></a>00627 <span class="preprocessor"></span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
